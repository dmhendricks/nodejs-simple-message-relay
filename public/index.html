<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <title>Simple Message Relay Demo</title>
    <meta name="description" content="NodePop - Demo" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="dns-prefetch" href="//cdn.jsdelivr.net" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basscss/css/basscss.min.css" />

    <style>
        body { font-family: Verdana, Geneva, sans-serif; margin: 2em; }
        a { color: #1155CC; }
        a:hover { color: #0C419E; }
        hr { background-color: #ccc; height: 1px; border: none; }
        #waiting { color: #777; font-style: italic; }
        p.message { color: #0c5460; background-color: #d1ecf1; border: 1px solid #bee5eb; padding: 0.5em 0.7em; }
        #status { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 0.1em 0.3em; font-size: 0.95em; }
        #status[data-connected="true"] { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; }
    </style>

</head>
<body>

    <main id="content">

        <h2>Simple Message Relay - Browser Demo</h2>
        <p>See the <a href="https://github.com/dmhendricks/nodejs-simple-message-relay/#usage" target="_blank">GitHub project page</a> for usage instructions.</p>
        <p>Socket.IO state: <span id="status" class="disconnected">Disconnected</span></p>

        <hr />

        <h4>Messages Received:</h4>
        <div id="waiting">Waiting...</div>
        <div id="messages"></div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2.3.0/dist/socket.io.slim.js"></script>

    <script>

        const socket = io.connect( 'http://127.0.0.1:3000', { reconnection: true } ); // Set reconnection to false to disable automatic reconnection

        (function($) {

            var socket_name = 'my-socket-name';
            var msg = $( '#messages' ), status = $( '#status' );

            // Set connection state
            socket.on( 'connect', function() {

                status.attr( 'data-connected', true ).html( 'Connected' );
                console.info( 'Connected: ' + socket_name );

            }).on( 'disconnect', function( reason ) {

                status.removeAttr( 'data-connected' ).html( 'Disconnected' );
                console.info( 'Connected: ' + socket_name );

            });

            // Listen for messages from Socket.IO
            socket.on( 'my-socket-name', function( payload ) {

                console.log( socket_name, payload );

                // Remove "Waiting..." element, if present
                $( '#waiting' ).remove();

                // Append incoming messages to element
                msg.append( '<p class="message">' + payload.content + '</p>' );
            });

        })( window.jQuery );

    </script>

</body>
</html>
